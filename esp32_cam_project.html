<!DOCTYPE html>
<html lang="zh-Hant-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ESP32-CAM å°ˆé¡Œå±•ç¤º</title>
    <style>
        /* ç¹¼æ‰¿è‡ªæ‚¨çš„å€‹äººé é¢æ¨£å¼ */
        body {
            font-family: Arial, sans-serif;
            margin: 40px;
            background-color: #f8f4e6; /* æ·¡è—è‰²èƒŒæ™¯ */
            color: #333;
            text-align: center;
        }
        .container {
            /* è®“å®¹å™¨å¯ä»¥å®¹ç´ 640px çš„å½±åƒ */
            max-width: 800px; 
            margin: auto;
            background: #f0f8ff; /* æ›´æ·¡çš„è—ç™½è‰²å®¹å™¨èƒŒæ™¯ */
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #5a5a5a;
        }
        h2 {
            color: #007bff;
            margin-top: 25px;
        }
        p {
            line-height: 1.6;
        }

        /* === è¿”å›æŒ‰éˆ•æ¨£å¼ Start (ç›´æ¥å¾æ‚¨çš„åŸå§‹ç¢¼è¤‡è£½) === */
        .back-button {
            background-color: #007bff;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            display: block; 
            width: 150px;
            margin: 0 0 20px 0; 
            text-align: center;
            transition: background-color 0.3s;
        }
        .back-button:hover {
            background-color: #0056b3;
        }
        /* === è¿”å›æŒ‰éˆ•æ¨£å¼ End === */

        /* === ESP32-CAM å°ˆç”¨æ¨£å¼ Start === */
        .cam-section {
            padding: 10px 0;
            text-align: center;
        }

        .cam-frame {
            width: 640px; /* å½±åƒå¯¬åº¦ 640px */
            height: 480px; /* å½±åƒé«˜åº¦ 480px */
            border: 4px solid #333;
            border-radius: 4px;
            margin: 20px auto;
            display: block;
            background-color: #000; /* æ¨¡æ“¬æ”å½±æ©Ÿçš„é»‘è‰²é‚Šæ¡†/èƒŒæ™¯ */
        }
        
        .cam-stream {
            width: 100%;
            height: 100%;
            object-fit: contain; /* ç¢ºä¿å½±åƒåœ¨æ¡†å…§å®Œæ•´é¡¯ç¤º */
            display: block;
        }

        .cam-controls button {
            background-color: #ff6600; /* æ©™è‰²æŒ‰éˆ•ï¼Œèˆ‡æ‚¨çš„è—è‰²ä¸»é¡Œå€éš” */
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            margin: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
        }

        .cam-controls button:hover {
            background-color: #cc5200;
        }
        
        .cam-controls button.off { 
            background-color: #5a5a5a; /* é—œé–‰ç‹€æ…‹çš„ç°è‰² */
        }

        /* éŸ¿æ‡‰å¼è¨­è¨ˆï¼šé‡å°å°è¢å¹•èª¿æ•´å½±åƒå¤§å° */
        @media (max-width: 680px) {
            .container {
                max-width: 100%;
                margin: 0;
            }
            .cam-frame {
                width: 100%; /* è®“å½±åƒæ¡†åœ¨å°è¢å¹•ä¸Šä½”æ»¿å¯¬åº¦ */
                height: auto;
                max-width: 400px; /* é™åˆ¶æœ€å¤§å¯¬åº¦ */
            }
        }
        /* === ESP32-CAM å°ˆç”¨æ¨£å¼ End === */

    </style>
</head>
<body>
    <div class="container">
        
        <button class="back-button" onclick="history.back()">
            â† è¿”å›ä¸Šä¸€é 
        </button>
        
        <h1>å³æ™‚ç›£æ§</h1>
        
        <div class="cam-section">
            <p>ESP32CAMå±•ç¤ºåŠé–ƒå…‰ç‡ˆæ§åˆ¶</p>
            <p style="font-size: 0.9em; color: #888;">æ³¨æ„ï¼šå½±åƒä¸²æµèˆ‡æ§åˆ¶åŠŸèƒ½åƒ…ç•¶æ‚¨çš„è£ç½®èˆ‡ ESP32-CAM è™•æ–¼åŒä¸€ Wi-Fi ç¶²è·¯æ™‚æœ‰æ•ˆã€‚</p>
            
            <hr>

            <h2>å³æ™‚å½±åƒä¸²æµ</h2>
            <div class="cam-frame">
                <img id="cam-stream-img" class="cam-stream" src="http://192.168.43.100/capture" alt="ESP32-CAM å½±åƒä¸²æµ">
            </div>

            <div class="cam-controls">
                <h2>é–ƒå…‰ç‡ˆæ§åˆ¶ (é ç«¯ I/O æ‡‰ç”¨)</h2>
                <button onclick="toggleFlash(true)" id="flash-on">ğŸ’¡ é–‹å•Ÿé–ƒå…‰ç‡ˆ</button>
                <button onclick="toggleFlash(false)" id="flash-off" class="off">ğŸ’¤ é—œé–‰é–ƒå…‰ç‡ˆ</button>
            </div>
        </div>

    </div>
    
    <script>
        // è¨­å®š ESP32-CAM çš„å®Œæ•´ IP ä½å€
        // ğŸš¨ å†æ¬¡æé†’ï¼šè«‹å°‡æ­¤ IP æ›¿æ›ç‚ºæ‚¨å¯¦éš›çš„ IP ğŸš¨
        const ESP32_CAM_IP = 'http://192.168.212.106'; 
        const streamImage = document.getElementById('cam-stream-img');
        
        // --- å½±åƒä¸²æµåŠŸèƒ½ (æ¯ 500ms æ›´æ–°ä¸€æ¬¡) ---
        setInterval(() => {
            // æ¯æ¬¡è«‹æ±‚éƒ½åŠ ä¸Šæ™‚é–“æˆ³ä»¥é¿å…ç€è¦½å™¨å¿«å–
            streamImage.src = ESP32_CAM_IP + '/capture?' + new Date().getTime();
        }, 500); 

        // --- é–ƒå…‰ç‡ˆæ§åˆ¶åŠŸèƒ½ (èˆ‡ ESP32 ç¨‹å¼ç¢¼ /led ç«¯é»å°æ‡‰) ---
        function toggleFlash(state) {
            const stateString = state ? 'on' : 'off';
            fetch(`${ESP32_CAM_IP}/led?state=${stateString}`)
                .then(r => r.text())
                .then(t => console.log(`Flash: ${stateString}`))
                .catch(e => {
                    console.error(`Error controlling flash: ${e}`);
                    alert(`ç„¡æ³•é€£ç·šåˆ° ESP32-CAM (IP: ${ESP32_CAM_IP})ï¼è«‹ç¢ºèª Wi-Fi é€£ç·šã€‚`);
                });
        }
    </script>
</body>
</html>